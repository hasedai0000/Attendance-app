# 勤怠管理システム Seeder ガイド

このディレクトリには、勤怠管理システムの検証に適切なテストデータを作成するための Seeder が含まれています。

## 含まれる Seeder

### 1. UserSeeder

-   **目的**: テスト用のユーザーデータを作成
-   **内容**:
    -   管理者ユーザー（2 名）
    -   一般ユーザー（12 名、メール認証済み）
    -   未認証ユーザー（2 名）
-   **特徴**: 重複チェック機能付き

### 2. AttendanceSeeder

-   **目的**: 多様な勤怠パターンのデータを作成
-   **内容**:
    -   過去 30 日分の勤怠データ（土日除く）
    -   6 つの勤怠パターン（通常、早出、遅刻、残業、短時間、不規則）
    -   勤務状態のバリエーション（勤務中、休憩中、退勤済み）
-   **特徴**: ユーザーごとに異なるパターンを適用

### 3. BreakSeeder

-   **目的**: 勤怠データに基づく休憩データを作成
-   **内容**:
    -   勤務時間に応じた休憩時間の自動計算
    -   6 時間未満: 休憩なし
    -   6-8 時間: 1 時間休憩
    -   8 時間以上: 昼休み + 午後休憩
-   **特徴**: 勤務時間に基づく自動休憩時間設定

### 4. ModificationRequestSeeder

-   **目的**: 修正申請のテストデータを作成
-   **内容**:
    -   承認待ちの修正申請
    -   承認済みの修正申請
    -   様々な修正理由
-   **特徴**: 管理者による承認フローのテスト

### 5. ModificationRequestBreakSeeder

-   **目的**: 修正申請に紐づく休憩時間の修正データを作成
-   **内容**:
    -   修正申請ごとの休憩時間変更
    -   複数の休憩時間修正
-   **特徴**: 休憩時間の修正申請フロー

### 6. TestScenarioSeeder

-   **目的**: 特定のテストシナリオ用データを作成
-   **内容**:
    -   勤務中ユーザー
    -   休憩中ユーザー
    -   退勤済みユーザー
    -   修正申請ありユーザー
    -   管理者ユーザー
    -   深夜勤務ユーザー
    -   短時間勤務ユーザー
-   **特徴**: テストケースに特化したデータ

## 使用方法

### 基本的な実行方法

```bash
# すべてのSeederを実行
php artisan db:seed

# 特定のSeederのみ実行
php artisan db:seed --class=UserSeeder
php artisan db:seed --class=AttendanceSeeder
php artisan db:seed --class=TestScenarioSeeder
```

### 開発環境での実行

```bash
# データベースをリセットしてからSeederを実行
php artisan migrate:fresh --seed

# 特定のSeederのみ実行（他のデータは保持）
php artisan db:seed --class=TestScenarioSeeder
```

### テスト環境での実行

```bash
# テスト用データベースでSeederを実行
php artisan db:seed --env=testing
```

## データの特徴

### ユーザーデータ

-   **管理者**: `admin@example.com`, `test@example.com` (パスワード: `password`)
-   **一般ユーザー**: `tanaka@example.com`, `sato@example.com` など (パスワード: `password`)
-   **未認証ユーザー**: `yamada@example.com`, `ito@example.com` (パスワード: `password`)

### 勤怠データ

-   **期間**: 過去 30 日分（土日除く）
-   **パターン**: 6 種類の勤務パターン
-   **状態**: 勤務外、勤務中、休憩中、退勤済み
-   **時間**: 8:00-22:00 の範囲でランダム生成

### 休憩データ

-   **自動計算**: 勤務時間に基づく休憩時間
-   **パターン**: 昼休み、午後休憩、深夜休憩
-   **時間**: 15 分〜1 時間の休憩

### 修正申請データ

-   **状態**: 承認待ち、承認済み
-   **内容**: 出勤時刻、退勤時刻、休憩時間の修正
-   **理由**: 電車遅延、会議、残業など

## テストシナリオ

### 1. 勤務状態のテスト

-   勤務中ユーザーの打刻操作
-   休憩中ユーザーの状態確認
-   退勤済みユーザーの履歴表示

### 2. 管理者機能のテスト

-   日次勤怠一覧の表示
-   スタッフ一覧の表示
-   修正申請の承認処理

### 3. 修正申請のテスト

-   修正申請の作成
-   承認待ち申請の一覧表示
-   承認処理の実行

### 4. エッジケースのテスト

-   深夜勤務の処理
-   短時間勤務の処理
-   不規則な勤務時間の処理

## 注意事項

1. **データの重複**: UserSeeder は重複チェック機能があるため、複数回実行しても安全です
2. **依存関係**: Seeder は順序に依存しているため、DatabaseSeeder を使用することを推奨します
3. **テストデータ**: 本番環境では実行しないでください
4. **パフォーマンス**: 大量のデータを作成するため、実行時間がかかる場合があります

## トラブルシューティング

### よくあるエラー

1. **外部キー制約エラー**

    - 解決方法: UserSeeder を先に実行してください

2. **メモリ不足エラー**

    - 解決方法: `php.ini`でメモリ制限を増やしてください

3. **タイムアウトエラー**
    - 解決方法: 実行時間制限を増やしてください

### ログの確認

Seeder 実行時は詳細なログが出力されます：

-   実行時間
-   作成されたデータ数
-   エラーの詳細
-   成功/失敗の統計

## カスタマイズ

### 新しいテストシナリオの追加

1. `TestScenarioSeeder`に新しいメソッドを追加
2. `generateTestScenarios`メソッドで呼び出しを追加
3. 必要に応じて新しい Seeder クラスを作成

### データ量の調整

各 Seeder のメソッド内で以下の値を調整できます：

-   生成するデータ数
-   日付の範囲
-   時間の範囲
-   パターンの種類

## サポート

Seeder に関する問題や質問がある場合は、開発チームまでお問い合わせください。
